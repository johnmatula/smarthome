var timeout,requests=!1,controlOutlets=function(t,e){$.ajaxQueue({url:"php/status.php",data:{action:t.attr("data-actiontype"),turnoff:e,outlets:t.attr("data-outlets").split(",")}}).done(function(t){requests&&requests.abort(),queryOutletStatus()})},queryOutletStatus=function(){requests=$.ajax({url:"php/status.json?nocache="+(new Date).getTime(),success:function(t){updateUI(t)},timeout:1750,error:function(t,e,o){console.warn("Status JSON returned error: "+o)}})},updateUI=function(e){Object.keys(e.outlets).forEach(function(t){$("button[data-outlets="+t+"]").attr("data-status",e.outlets[t]?"on":"off")}),Object.keys(e.rooms).forEach(function(t){$(".room[data-outlets="+t+"]").attr("data-status",e.rooms[t]?"on":"off")}),"additive"==e.behavior?$("button[data-actiontype=behavior]").html('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" \t width="20px" height="20px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <line fill="none" stroke="#414042" stroke-width="2" stroke-miterlimit="10" x1="1" y1="12" x2="11" y2="2"/> <polyline fill="none" stroke="#414042" stroke-width="2" stroke-miterlimit="10" points="11,8 11,2 5,2 "/> <line fill="none" stroke="#414042" stroke-width="2" stroke-miterlimit="10" x1="8" y1="19" x2="18" y2="9"/> <polyline fill="none" stroke="#414042" stroke-width="2" stroke-miterlimit="10" points="18,15 18,9 12,9 "/> </svg> '):$("button[data-actiontype=behavior]").html('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" \t width="20px" height="20px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <g> \t<line fill="none" stroke="#414042" stroke-width="2" stroke-miterlimit="10" x1="2" y1="1.668" x2="8" y2="7.668"/> \t<polyline fill="none" stroke="#414042" stroke-width="2" stroke-miterlimit="10" points="12,18 18,18 18,12 \t"/> \t<line fill="none" stroke="#414042" stroke-width="2" stroke-miterlimit="10" x1="2" y1="17.668" x2="18" y2="1.668"/> \t<polyline fill="none" stroke="#414042" stroke-width="2" stroke-miterlimit="10" points="18,8 18,2 12,2 \t"/> \t<line fill="none" stroke="#414042" stroke-width="2" stroke-miterlimit="10" x1="12" y1="11.668" x2="18" y2="17.668"/> </g> </svg> ')},refreshClock=function(){$(".clock__time").html(moment().format("h:mm")),$(".clock__weekday").html(moment().format("dddd")),$(".clock__date").html(moment().format("D MMMM"))};$(function(){$("button[data-actiontype], .room").longpress(function(){controlOutlets($(this),"off")},function(){controlOutlets($(this),"")},500),$(".clock__weekday").longpress(function(){window.location.reload()},function(){},100),FastClick.attach(document.body),queryOutletStatus();setInterval(queryOutletStatus,2e3);refreshClock();setInterval(refreshClock,2500)}),function(a){var u=a({});a.ajaxQueue=function(n){function r(t){i=a.ajax(n).done(s.resolve).fail(s.reject).then(t,t)}var i,s=a.Deferred(),l=s.promise();return u.queue(r),l.abort=function(t){if(i)return i.abort(t);var e=u.queue(),o=a.inArray(r,e);return-1<o&&e.splice(o,1),s.rejectWith(n.context||n,[l,t,""]),l},l}}(jQuery);