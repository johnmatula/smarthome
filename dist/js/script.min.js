var timeout,specialInterval,previousButton,requests=!1,weatherapikey=!1,PRIDE_COLOR_COUNT=9,BUTTON_COUNT=16,controlOutlets=function(t,e){$.ajaxQueue({url:"php/status.php",data:{action:t.attr("data-actiontype"),turnoff:e,outlets:t.attr("data-outlets").split(",")}}).done(function(t){requests&&requests.abort(),queryOutletStatus()})},updateWeatherFirstTime=function(){$.ajax({url:"php/apikey.php",success:function(t){weatherapikey=t,updateWeather()},timeout:1e3,error:function(t,e,o){console.warn("Status JSON returned error: "+o)}})},queryOutletStatus=function(){requests=$.ajax({url:"php/status.json?nocache="+(new Date).getTime(),success:function(t){updateUI(t)},timeout:1750,error:function(t,e,o){console.warn("Status JSON returned error: "+o)}})},updateUI=function(e){Object.keys(e.outlets).forEach(function(t){$("button[data-outlets*="+t+"]").attr("data-status",e.outlets[t]?"on":"off")}),Object.keys(e.rooms).forEach(function(t){$(".room[data-outlets*="+t+"]").attr("data-status",e.rooms[t]?"on":"off")})},refreshClock=function(){$(".clock__time").html(moment().format("h:mm")),$(".clock__weekday").html(moment().format("dddd")),$(".clock__date").html(moment().format("D MMMM"))},updateWeather=function(){$.ajax({url:"https://api.openweathermap.org/data/2.5/weather?lat=40.780366&lon=-73.948188&appid="+weatherapikey+"&units=imperial",success:function(t){$(".weather__temp").text(Math.round(t.main.temp)+"°"),$(".weather__humidity").text("Humidity "+Math.round(t.main.humidity)+"%");var e=calculateFeels(t.main.temp,t.main.humidity,t.wind.speed);!1!==e?$(".weather__feels").text("Feels like "+Math.round(e)+"°"):$(".weather__feels").text(""),.5<=t.wind.speed?$(".weather__wind").text("Wind "+Math.round(t.wind.speed)).append(" <span class='weather__windunit'>MPH</span>"):$(".weather__wind").text("Wind is calm")},timeout:3e3,error:function(t,e,o){console.warn("Weather returned error: "+o)}})};function calculateFeels(t,e,o){var a=!1;return 75<=t?(a=calculateHeatIndex(t,e))<=t&&(a=!1):t<=55&&3<=o&&t<=(a=calculateWindChill(t,o))&&(a=!1),a}function calculateHeatIndex(t,e){if(((o=.5*(t+61+1.2*(t-68)+.094*e))+t)/2<80)return t;var o=2.04901523*t-42.379+10.14333127*e-.22475541*t*e-.00683783*t*t-.05481717*e*e+.00122874*t*t*e+85282e-8*t*e*e-199e-8*t*t*e*e;return 80<=t&&t<=112&&e<13?o-=(13-e)/4*Math.sqrt((17-Math.abs(t-95))/17):80<=t&&t<=87&&85<e&&(o+=(e-85)/10*((87-t)/5)),Math.round(o)}function calculateWindChill(t,e){return Math.round(35.74+.6215*t-35.75*Math.pow(e,.16)+.4275*t*Math.pow(e,.16))}function setTheme(t){window.clearInterval(specialInterval),t=t||localStorage.getItem("smarthomeTheme")||"dark",$(".toggles__button svg").removeClass("svg--pride"),$(".toggles__button svg").removeClass(function(t,e){return(e.match(/\bsvg--pride--color\S+/g)||[]).join(" ")}),$(".js--selected").removeClass("js--selected"),$("button[data-theme="+t+"]").parent().addClass("js--selected"),"dark"==t?cssVars({variables:{"--background-body":"#000","--background-settings":"rgba(15,15,15,.975)","--background-backdrop":"#292B2A","--background-outlet-off":"#292B2A00","--background-outlet-off-active":"#79FEBC","--background-outlet-on":"#494B4A","--background-outlet-on-active":"#19653F","--color-emphasis":"#DAE0DD","--color-body":"#838785","--color-outlet-off":"#DAE0DD","--color-outlet-off-active":"#FFF","--color-outlet-on":"#FAFFFC","--color-outlet-on-active":"#DAE0DD","--color-scene":"#838785"}}):"daylight"==t?cssVars({variables:{"--background-body":"#fefefe","--background-settings":"rgba(250,250,250,.975)","--background-backdrop":"#f4f4f4","--background-outlet-off":"#f4f4f400","--background-outlet-off-active":"#79FEBC","--background-outlet-on":"#79FEBC","--background-outlet-on-active":"#19653F","--color-emphasis":"#111","--color-body":"#777","--color-outlet-off":"#777","--color-outlet-off-active":"#000","--color-outlet-on":"#000","--color-outlet-on-active":"#000","--color-scene":"#777"}}):"pride"==t&&(cssVars({variables:{"--background-body":"#000","--background-settings":"rgba(15,15,15,.975)","--background-backdrop":"#292929","--background-outlet-off":"rgba(0, 0, 0, 0)","--background-outlet-off-active":"rgba(255, 255, 255, 0.4)","--background-outlet-on":"rgba(255, 255, 255, 0.1)","--background-outlet-on-active":"rgba(255, 255, 255, 0.2)","--color-emphasis":"rgba(255, 255, 255, .875)","--color-body":"#858585","--color-outlet-off":"rgba(255, 255, 255, .875)","--color-outlet-off-active":"#fff","--color-outlet-on":"rgba(255, 255, 255, .975)","--color-outlet-on-active":"#fff","--color-scene":"#838785"}}),setPrideColors(),specialInterval=window.setInterval(changePrideColors,5e3)),localStorage.setItem("smarthomeTheme",t)}function setPrideColors(){$(".toggles__button svg").each(function(){$(this).addClass("svg--pride");var t=Math.floor(Math.random()*PRIDE_COLOR_COUNT);$(this).addClass("svg--pride--color"+t)})}function changePrideColors(){for(var t=[];t.length<4;){var e=Math.floor(Math.random()*BUTTON_COUNT)+1;-1===t.indexOf(e)&&t.push(e)}for(var o=0;o<t.length;o++){for(var a,r=!1,n=$(".toggles__button:nth-child("+t[o]+") svg");!r;)a=Math.floor(Math.random()*PRIDE_COLOR_COUNT),n.hasClass("svg--pride--color"+a)||(n.removeClass(function(t,e){return(e.match(/\bsvg--pride--color\S+/g)||[]).join(" ")}),r=!0);n.addClass("svg--pride--color"+a)}}$(function(){$("button[data-actiontype], .room").longpress(function(){controlOutlets($(this),"off")},function(){controlOutlets($(this),"")},500),$("button[data-settings]").click(function(t){$button=$(t.target),"reload"==$button.attr("data-settings")?window.location.reload():"reset"==$button.attr("data-settings")?(localStorage.clear(),window.location.reload()):"theme"==$button.attr("data-settings")&&setTheme($button.attr("data-theme"))}),$(".clock, .headerbar__close").click(function(){$(".settings").toggleClass("js--visible")}),FastClick.attach(document.body),queryOutletStatus();setInterval(queryOutletStatus,2e3);refreshClock();setInterval(refreshClock,2500);updateWeatherFirstTime();setInterval(updateWeather,3e5);setTheme(),cssVars({watch:!0})}),function(c){var l=c({});c.ajaxQueue=function(a){function r(t){n=c.ajax(a).done(s.resolve).fail(s.reject).then(t,t)}var n,s=c.Deferred(),u=s.promise();return l.queue(r),u.abort=function(t){if(n)return n.abort(t);var e=l.queue(),o=c.inArray(r,e);return-1<o&&e.splice(o,1),s.rejectWith(a.context||a,[u,t,""]),u},u}}(jQuery),$.fn.random=function(){return this.eq(Math.floor(Math.random()*this.length))};